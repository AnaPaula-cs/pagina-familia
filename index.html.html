<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3° SÉRIE MÉDIO - Mapa de Mesas da Formatura</title>
    <style>
        /* Estilos base */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        /* Estilos do cabeçalho */
        header {
            background-color: #ffffff;
            padding: 15px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 3px solid #ccc;
        }

        /* Título da turma */
        header h1 {
            color: #4a4a4a;
            font-size: 28px;
            margin: 0;
        }

        /* Container principal */
        .container {
            display: flex;
            max-width: 1200px;
            margin: 20px auto;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 120px);
        }

        /* Área de mesas */
        .mapa-container {
            flex: 2;
            padding: 20px 0 0 0;
            background-color: #dedee9;
            position: relative;
        }

        /* Área de lista de mesas */
        .lista-container {
            flex: 1;
            padding: 20px;
            background-color: #fff;
            border-left: 1px solid #ccc;
        }
        
        /* Controles de ADM (Inicialmente ocultos) */
        .admin-controls {
            display: none; /* Escondido por padrão */
            padding-top: 15px;
            border-top: 1px solid #ccc;
            margin-top: 15px;
        }
        .admin-mode .admin-controls {
            display: block; /* Visível no modo ADM */
        }
        .admin-mode .lista-mesas .input-admin {
            display: flex;
        }


        /* Estilo do palco */
        .palco {
            background-color: #f7d63d;
            width: 80%;
            height: 80px;
            margin: 0 auto;
            text-align: center;
            line-height: 80px;
            font-weight: bold;
            color: #333;
            font-size: 24px;
            clip-path: polygon(10% 0, 90% 0, 100% 100%, 0% 100%);
            position: relative;
            z-index: 3;
            margin-bottom: 50px; 
        }

        /* Passarela Vermelha */
        .passarela {
            position: absolute;
            top: calc(80px + 50px); 
            left: 50%;
            transform: translateX(-50%);
            width: 80px; 
            bottom: 0;
            background-color: #d90000;
            z-index: 1;
        }

        /* Estrutura de Grid para TODAS as Mesas (Mantidos) */
        .mesas-area {
            position: relative;
            display: flex;
            justify-content: space-around; 
            align-items: flex-start;
            width: 95%; 
            max-width: 1000px; 
            margin: 0 auto;
            z-index: 2;
            padding-top: 0; 
            padding-bottom: 20px;
        }
        
        .lado-esquerdo, .lado-direito {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: repeat(5, 1fr); 
            grid-gap: 30px 40px; 
            width: 42%; 
            position: relative;
            padding: 10px;
            grid-auto-flow: row; 
        }

        /* Estilo da MESA COMPLETA (Mantidos) */
        .mesa-wrap {
            position: relative;
            width: 100px; 
            height: 100px; 
            border-radius: 50%;
            background-color: #e59325; 
            box-shadow: 
                0 0 0 8px rgba(0, 0, 0, 0.2), 
                0 0 0 2px #d0821e inset, 
                0 0 0 4px #d0821e; 
            border: 1px solid #c07718; 
            background-image: radial-gradient(circle at center, #f5a83b 0%, #e59325 70%); 
            
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Linha divisória entre A e B (Mantidos) */
        .mesa-wrap::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px; 
            background-color: rgba(0, 0, 0, 0.3);
            transform: translateX(-50%);
            z-index: 1;
        }
        
        /* Estilo do assento (Mantidos) */
        .assento {
            position: absolute;
            background-color: transparent;
            color: white;
            width: 50%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1em; 
            cursor: pointer; 
            z-index: 2;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .assento:hover {
            opacity: 0.9;
        }

        .assento[data-id$="A"] { left: 0; transform: rotate(-90deg) translateX(0) translateY(8px); }
        .assento[data-id$="B"] { right: 0; transform: rotate(-90deg) translateX(0) translateY(-8px); }

        /* Estilo para assento indisponível (Mantidos) */
        .assento.indisponivel {
            color: #ccc;
            cursor: default; 
            opacity: 0.7;
            pointer-events: none; 
        }
        
        /* Estilos da lista (AJUSTADOS para a nova estrutura de ADM) */
        .lista-mesas { 
            list-style: none; 
            padding: 0; 
            max-height: 80vh; 
            overflow-y: auto; 
        }
        .lista-mesas li { 
            display: flex; 
            flex-wrap: nowrap; 
            margin-bottom: 8px; 
            align-items: center; 
            border-bottom: 1px dotted #ccc; 
            padding-bottom: 5px; 
        }
        .lista-mesas label { 
            font-weight: bold; 
            width: 35px; 
            text-align: right; 
            margin-right: 5px; 
            flex-shrink: 0;
        }
        .lista-mesas .status-info {
            flex-grow: 1;
            padding-left: 10px;
            font-size: 0.9em;
            color: #555;
            display: flex;
            align-items: center;
            /* Adiciona flex-wrap para permitir que o nome longo quebre a linha */
            flex-wrap: wrap; 
        }
        .lista-mesas .input-admin {
            display: none; /* Escondido por padrão */
            flex-grow: 1;
        }
        .lista-mesas .input-admin input {
            flex-grow: 1; 
            padding: 5px; 
            border: 1px solid #ccc; 
            border-radius: 3px; 
            margin-left: 5px; 
            min-width: 50px;
        }
        .lista-mesas .disponibilidade { 
            display: inline-block; 
            width: 15px; 
            height: 15px; 
            border-radius: 50%; 
            margin-left: 10px; 
            flex-shrink: 0;
        }
        .disponivel { background-color: green; }
        .reservado { background-color: red; }
        
        /* Estilo do botão de liberação (SÓ ADM) */
        .btn-liberar {
            background-color: #d9534f;
            color: white;
            border: none;
            padding: 5px 8px;
            margin-left: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
            flex-shrink: 0;
            transition: background-color 0.2s;
        }
        .btn-liberar:hover {
            background-color: #c9302c;
        }
        .btn-liberar:disabled {
            background-color: #ccc;
            cursor: default;
        }
        
        /* Estilos do Login ADM */
        .admin-login {
            padding-bottom: 10px;
            border-bottom: 1px solid #ccc;
            margin-bottom: 15px;
        }
        .admin-login input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            margin-right: 5px;
        }
        .admin-login button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <header>
        <h1>3° SÉRIE MÉDIO - Mapa de Mesas da Formatura</h1>
    </header>

    <div class="container">
        <div class="mapa-container">
            <div class="palco">PALCO</div>
            
            <div class="passarela"></div> 

            <div class="mesas-area">
                <div class="lado-esquerdo" id="lado-esquerdo">
                    </div>
                <div class="lado-direito" id="lado-direito">
                    </div>
            </div>
        </div>

        <div class="lista-container" id="lista-container">
            <h2>Mesas (Status)</h2>

            <div class="admin-login">
                <input type="password" id="admin-password" placeholder="Senha ADM">
                <button onclick="loginAdmin()">Entrar</button>
            </div>
            
            <ul class="lista-mesas" id="lista-mesas-inputs">
                </ul>

            <div class="admin-controls">
                <p>Modo Administrador Ativo</p>
                <button onclick="confirmarLimpezaTotal()" style="background-color: #333; color: white; border: none; padding: 8px 15px; cursor: pointer; border-radius: 3px;">
                    LIMPAR TODAS AS RESERVAS (Mestre)
                </button>
            </div>
        </div>
    </div>

    <script>
        const NUM_MESAS = 20; 
        const ADMIN_PASSWORD = "montessori123"; // **** SENHA SECRETA ****
        
        const mapaEsquerdo = document.getElementById('lado-esquerdo');
        const mapaDireito = document.getElementById('lado-direito');
        const listaInputs = document.getElementById('lista-mesas-inputs');
        const listaContainer = document.getElementById('lista-container');

        let reservas = {}; 

        // 1. GERAÇÃO E CARREGAMENTO INICIAL (Mantidos)
        function gerarReservasIniciais() {
            for (let i = 1; i <= NUM_MESAS; i++) {
                reservas[`${i}A`] = { reservado: false, nome: '' };
                reservas[`${i}B`] = { reservado: false, nome: '' };
            }
        }

        function carregarReservas() {
            const reservasSalvas = localStorage.getItem('reservasMontessoriano');
            if (reservasSalvas) {
                reservas = JSON.parse(reservasSalvas);
                for (let i = 1; i <= NUM_MESAS; i++) {
                    if (!reservas[`${i}A`]) reservas[`${i}A`] = { reservado: false, nome: '' };
                    if (!reservas[`${i}B`]) reservas[`${i}B`] = { reservado: false, nome: '' };
                }
            } else {
                gerarReservasIniciais();
            }
        }

        function salvarReservas() {
            localStorage.setItem('reservasMontessoriano', JSON.stringify(reservas));
        }

        // 2. RENDERIZAÇÃO DO MAPA (Mantidos - Ordem M3.jpeg)
        function renderizarMapa() {
            mapaEsquerdo.innerHTML = '';
            mapaDireito.innerHTML = '';

            const mesasEsquerda = [1, 2, 5, 6, 9, 10, 13, 14, 17, 18];
            const mesasDireita = [3, 4, 7, 8, 11, 12, 15, 16, 19, 20];

            mesasEsquerda.forEach(numMesa => {
                mapaEsquerdo.appendChild(criarMesaWrap(numMesa));
            });

            mesasDireita.forEach(numMesa => {
                mapaDireito.appendChild(criarMesaWrap(numMesa));
            });
        }

        function criarMesaWrap(i) {
             const mesaWrap = document.createElement('div');
             mesaWrap.className = 'mesa-wrap';
             mesaWrap.id = `mesa-${i}`; 
             mesaWrap.title = `Mesa ${i}`;
             
             const assentoA = criarAssento(`${i}A`);
             mesaWrap.appendChild(assentoA);

             const assentoB = criarAssento(`${i}B`);
             mesaWrap.appendChild(assentoB);
             
             return mesaWrap;
        }
        
        function criarAssento(id) {
            const assento = document.createElement('div');
            assento.className = 'assento';
            assento.id = `assento-${id}`;
            assento.textContent = id; 
            assento.dataset.id = id;

            const estado = reservas[id];
            
            // Adiciona o nome do aluno ao title (tooltip) no mapa
            if (estado && estado.reservado) {
                assento.classList.add('indisponivel');
                assento.title = `Reservado por: ${estado.nome || 'Desconhecido'}`; 
            } else {
                // Usuários SÓ podem clicar se o assento estiver disponível
                assento.addEventListener('click', () => abrirModalSelecao(id));
            }
            return assento;
        }


        // 3. RENDERIZAÇÃO DA LISTA DE INPUTS (ADICIONANDO O NOME PARA O MODO NÃO-ADM)
        function renderizarListaInputs() {
            listaInputs.innerHTML = '';

            const isAdmin = listaContainer.classList.contains('admin-mode');

            for (let i = 1; i <= NUM_MESAS; i++) {
                listaInputs.appendChild(criarItemLista(`${i}A`, isAdmin));
                listaInputs.appendChild(criarItemLista(`${i}B`, isAdmin));
            }
        }

        function criarItemLista(id, isAdmin) {
            const li = document.createElement('li');
            const estado = reservas[id];
            
            // CONTEÚDO PARA O MODO NÃO-ADM (AGORA INCLUI O NOME)
            let statusInfoContent = '';
            if (estado.reservado) {
                // EXIBE O NOME DO ALUNO QUANDO RESERVADO
                statusInfoContent = `<span class="status-info" id="info-${id}" title="${estado.nome || ''}">Reservado por: <strong>${estado.nome || 'Nome não registrado'}</strong></span>`;
            } else {
                statusInfoContent = `<span class="status-info" id="info-${id}">Disponível</span>`;
            }

            li.innerHTML = `
                <label for="input-${id}">${id}:</label>
                <span id="status-${id}" class="disponibilidade ${estado.reservado ? 'reservado' : 'disponivel'}" title="${estado.reservado ? 'Reservado' : 'Disponível'}"></span>
                
                ${isAdmin ? 
                    `
                    <div class="input-admin">
                        <input type="text" id="input-${id}" placeholder="Nome do Aluno" value="${estado.nome}" data-id="${id}" />
                        <button class="btn-liberar" data-id="${id}" onclick="liberarAssento('${id}')" ${estado.reservado ? '' : 'disabled'}>Liberar</button>
                    </div>
                    `
                    :
                    // MODO PADRÃO (USUÁRIO)
                    statusInfoContent
                }
            `;
            
            if (isAdmin) {
                const input = li.querySelector(`#input-${id}`);
                
                input.addEventListener('input', (e) => {
                    const novoNome = e.target.value;
                    reservas[id].nome = novoNome;
                    salvarReservas();

                    // Atualiza o mapa e a lista de informações
                    const assentoMapa = document.getElementById(`assento-${id}`);
                    if (assentoMapa) {
                         assentoMapa.title = `Reservado por: ${novoNome || 'Desconhecido'}`;
                    }
                    const infoElement = document.getElementById(`info-${id}`);
                    if(infoElement && reservas[id].reservado) {
                        infoElement.innerHTML = `Reservado por: <strong>${novoNome || 'Nome não registrado'}</strong>`;
                        infoElement.title = novoNome || '';
                    }
                });
            }

            return li;
        }
        
        // 4. LÓGICA DE SELEÇÃO E RESERVA (Atualiza os campos de informação do usuário)
        function abrirModalSelecao(idDesejado) { 
            if (reservas[idDesejado].reservado) {
                alert(`O assento ${idDesejado} já está reservado por ${reservas[idDesejado].nome}.`);
                return;
            }
            
            const nomeAluno = prompt(`Confirme a reserva do assento ${idDesejado}.\nDigite seu nome completo:`);

            if (nomeAluno && nomeAluno.trim() !== "") {
                const nomeLimpa = nomeAluno.trim();
                
                reservas[idDesejado].reservado = true;
                reservas[idDesejado].nome = nomeLimpa;

                salvarReservas();

                // 1. Atualiza o mapa
                const assentoMapaAntigo = document.getElementById(`assento-${idDesejado}`);
                if (assentoMapaAntigo) {
                    const new_assento = criarAssento(idDesejado); // Recria o assento como 'indisponível'
                    assentoMapaAntigo.parentNode.replaceChild(new_assento, assentoMapaAntigo);
                }
                
                // 2. Atualiza os elementos de status na lista
                const statusElement = document.getElementById(`status-${idDesejado}`);
                if (statusElement) {
                     statusElement.classList.remove('disponivel');
                     statusElement.classList.add('reservado');
                     statusElement.title = 'Reservado';
                }
                
                const isAdmin = listaContainer.classList.contains('admin-mode');
                
                if (isAdmin) {
                     // Modo ADM: Atualiza input e botão
                     const inputElement = document.getElementById(`input-${idDesejado}`);
                     if (inputElement) { inputElement.value = nomeLimpa; }
                     const liberarBtn = document.querySelector(`.btn-liberar[data-id="${idDesejado}"]`);
                     if(liberarBtn) { liberarBtn.disabled = false; }
                } else {
                    // Modo Usuário: Atualiza o span de informação com o nome
                    const infoElement = document.getElementById(`info-${idDesejado}`);
                    if(infoElement) {
                        infoElement.innerHTML = `Reservado por: <strong>${nomeLimpa}</strong>`;
                        infoElement.title = nomeLimpa;
                    }
                }

                alert(`Assento ${idDesejado} reservado com sucesso para ${nomeLimpa}!`);
                
            } else if (nomeAluno !== null) {
                alert('Nome não fornecido. Reserva cancelada.');
            }
        }
        
        // 5. FUNÇÕES DE ADM (Liberar e Limpar Tudo)
        window.liberarAssento = function(id) {
            if (!listaContainer.classList.contains('admin-mode')) {
                alert('Acesso negado. Apenas o administrador pode liberar assentos.');
                return;
            }
            if (!confirm(`Tem certeza que deseja LIBERAR o assento ${id}? Esta ação não pode ser desfeita.`)) {
                return;
            }

            reservas[id].reservado = false;
            reservas[id].nome = '';
            salvarReservas();

            // 1. Atualiza o mapa
            const assentoMapaAntigo = document.getElementById(`assento-${id}`);
            if (assentoMapaAntigo) {
                const new_assento = criarAssento(id); // Recria o assento como 'clicável'
                assentoMapaAntigo.parentNode.replaceChild(new_assento, assentoMapaAntigo);
            }

            // 2. Atualiza a lista ADM
            const inputElement = document.getElementById(`input-${id}`);
            if (inputElement) { inputElement.value = ''; }
            
            const liberarBtn = document.querySelector(`.btn-liberar[data-id="${id}"]`);
            if(liberarBtn) { liberarBtn.disabled = true; }
            
            // 3. Atualiza o status para todos os modos
            const statusElement = document.getElementById(`status-${id}`);
            if (statusElement) {
                 statusElement.classList.remove('reservado');
                 statusElement.classList.add('disponivel');
                 statusElement.title = 'Disponível';
            }
            
            const infoElement = document.getElementById(`info-${id}`);
            if(infoElement) {
                infoElement.innerHTML = `Disponível`;
                infoElement.title = '';
            }

            alert(`Assento ${id} liberado com sucesso.`);
        }
        
        window.confirmarLimpezaTotal = function() {
            if (!listaContainer.classList.contains('admin-mode')) {
                alert('Acesso negado. Apenas o administrador pode limpar todas as reservas.');
                return;
            }
            if (confirm("ATENÇÃO: Você está prestes a LIMPAR TODAS as reservas feitas. Esta ação é irreversível.\n\nConfirme para continuar a exclusão total.")) {
                localStorage.removeItem('reservasMontessoriano');
                gerarReservasIniciais(); 
                renderizarMapa();
                renderizarListaInputs();
                alert('Todas as reservas foram removidas e o mapa foi resetado.');
            }
        }
        
        // 6. LÓGICA DE LOGIN ADM (Mantida)
        window.loginAdmin = function() {
            const passwordInput = document.getElementById('admin-password');
            if (passwordInput.value === ADMIN_PASSWORD) {
                listaContainer.classList.add('admin-mode');
                renderizarListaInputs(); // Redesenha a lista no modo ADM
                alert('Login de Administrador realizado com sucesso!');
                passwordInput.parentNode.style.display = 'none';
            } else {
                alert('Senha incorreta. Acesso negado.');
                passwordInput.value = '';
            }
        }
        
        // 7. INICIALIZAÇÃO (Mantida)
        function iniciarSistema() {
            carregarReservas();
            renderizarMapa();
            renderizarListaInputs();
        }

        window.onload = iniciarSistema;
    </script>
</body>
</html>